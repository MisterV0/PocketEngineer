<!-- START OF FILE voltage.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/svg+xml" href="resources/NewLogo.svg">
  <link rel="apple-touch-icon" href="resources/NewLogo.svg">
  <title>Voltage Divider Calculator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] },
          keyframes: {
            'pop-text': {
              '0%': { transform: 'scale(1)', color: 'white' },
              '50%': { transform: 'scale(1.05)', color: '#d4d4d8' },
              '100%': { transform: 'scale(1)', color: 'white' },
            }
          },
          animation: {
            'pop': 'pop-text 0.2s ease-out'
          }
        }
      }
    }
  </script>
  <style>
    /* Reset & Polish */
    body { font-feature-settings: "cv05", "cv08", "ss01"; -webkit-font-smoothing: antialiased; }
    
    input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; }
    input[type=number] { -moz-appearance: textfield; }

    /* Input Focus State wrapper */
    .ios-input-wrapper {
      transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    .ios-input-wrapper:focus-within {
      border-color: #3f3f46; /* zinc-700 */
      box-shadow: 0 0 0 3px rgba(63, 63, 70, 0.1);
      transform: translateY(-1px);
    }

    /* Explanation Accordion Transition */
    details > summary { list-style: none; outline: none; }
    details > summary::-webkit-details-marker { display: none; }
    details[open] summary ~ * { animation: sweep .3s ease-in-out; }
    
    @keyframes sweep {
      0%    { opacity: 0; transform: translateY(-5px); }
      100%  { opacity: 1; transform: translateY(0); }
    }

    /* Custom Slider Styling */
    .slider-track {
        -webkit-appearance: none;
        width: 100%;
        background: transparent;
    }
    .slider-track:focus { outline: none; }

    /* Webkit Thumb */
    .slider-track::-webkit-slider-thumb {
        -webkit-appearance: none;
        height: 20px;
        width: 20px;
        border-radius: 50%;
        background: #ffffff;
        border: 1px solid #71717a; 
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        cursor: pointer;
        margin-top: -8px; 
        transition: transform 0.1s ease;
    }
    .slider-track::-webkit-slider-thumb:hover { transform: scale(1.1); border-color: #18181b; }
    .slider-track::-webkit-slider-thumb:active { transform: scale(0.95); background: #f4f4f5; }

    /* Webkit Track */
    .slider-track::-webkit-slider-runnable-track {
        width: 100%;
        height: 4px;
        cursor: pointer;
        background: #e4e4e7;
        border-radius: 9999px;
    }

    /* Back Button Styling - Enhanced */
    .back-button { 
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.875rem;
      border-radius: 0.5rem;
      font-size: 0.75rem;
      font-weight: 600;
      color: #71717a;
      border: 1px solid #e4e4e7;
      background-color: white;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      text-decoration: none;
      cursor: pointer;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
      letter-spacing: 0.5px;
      position: relative;
      overflow: hidden;
    }
    .back-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.5s ease;
    }
    .back-button:hover {
      color: #18181b;
      border-color: #71717a;
      background-color: #ffffff;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      transform: translateY(-2px);
    }
    .back-button:hover::before {
      left: 100%;
    }
    .back-button:hover svg {
      transform: translateX(-2px);
    }
    .back-button:active { 
      transform: scale(0.96);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .back-button svg {
      transition: transform 0.2s ease;
    }
  </style>
</head>
<body class="bg-[#F5F5F7] text-zinc-900 h-screen flex flex-col md:flex-row overflow-hidden selection:bg-zinc-200 selection:text-zinc-900">

  <!-- Left Column: Controls & Logic -->
  <aside class="w-full md:w-[420px] bg-white border-r border-zinc-300 flex flex-col h-full shadow-[20px_0_40px_rgba(0,0,0,0.02)] z-20 relative">
    
    <!-- Header -->
    <header class="flex-none p-8 pb-4 border-b border-zinc-100">
      <div class="flex items-center gap-4 mb-0">
        <a href="index.html" class="back-button">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M15 18l-6-6 6-6"/></svg>
          Back
        </a>
        <h2 class="text-2xl font-bold tracking-tight text-zinc-900">Voltage Divider</h2>
      </div>
    </header>

    <div class="flex-1 overflow-y-auto p-8 pt-6 space-y-8">
      
      <!-- Theory Section -->
      <div class="bg-zinc-50 rounded-2xl border border-zinc-200 overflow-hidden shadow-sm">
        <details class="group open:pb-4">
          <summary class="flex justify-between items-center font-medium cursor-pointer p-4 hover:bg-zinc-100 transition-colors select-none">
            <span class="text-sm">Logic & Formula</span>
            <span class="text-zinc-400 group-open:rotate-180 transition-transform">
              <svg width="12" height="12" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3" fill="none"><path d="M6 9l6 6 6-6"/></svg>
            </span>
          </summary>
          <div class="px-5 text-sm leading-relaxed text-zinc-600 space-y-3 pt-2">
            <p>
              Splits a source voltage (<span class="font-mono text-xs text-zinc-700">Vin</span>) into a smaller output (<span class="font-mono text-xs text-zinc-700">Vout</span>) based on the resistor ratio.
            </p>
            <div class="bg-white border border-zinc-200 rounded-lg p-3 flex justify-center items-center shadow-sm">
              <span class="font-mono text-xs text-zinc-900 font-semibold">
                V<sub>out</sub> = V<sub>in</sub> × <span class="inline-flex flex-col text-center align-middle mx-1 text-zinc-500 font-medium"><span class="border-b border-zinc-300">R2</span><span>R1 + R2</span></span>
              </span>
            </div>
          </div>
        </details>
      </div>

      <!-- Controls -->
      <form class="space-y-6" onsubmit="return false;">
        
        <!-- Vin Control -->
        <div class="group/input">
          <div class="flex items-center gap-2 mb-2">
              <label class="text-[11px] font-bold text-zinc-400 uppercase tracking-wider">Source Input</label>
              <div class="relative group/tooltip cursor-help">
                 <div class="w-4 h-4 rounded-full border border-zinc-300 flex items-center justify-center text-[10px] text-zinc-400 hover:border-zinc-500 hover:text-zinc-600 transition-colors">?</div>
                 <div class="absolute left-6 top-1/2 -translate-y-1/2 w-48 p-2 bg-zinc-800 text-white text-[11px] rounded shadow-xl opacity-0 group-hover/tooltip:opacity-100 pointer-events-none transition-opacity z-50">
                    The total voltage provided by your battery or power supply.
                 </div>
              </div>
          </div>
          
          <div class="ios-input-wrapper flex items-center justify-between bg-white border border-zinc-300 rounded-lg px-3 py-2.5">
             <label for="vin" class="text-sm font-medium text-zinc-500 shrink-0 w-8 select-none">V<sub>in</sub></label>
             <input type="number" id="vin" value="5.0" step="0.1" oninput="calculate('inputs')" class="text-right w-full bg-transparent border-none p-0 text-sm font-mono font-medium focus:ring-0 placeholder-zinc-300 text-zinc-900 outline-none">
             <span class="text-xs text-zinc-400 font-medium ml-2 w-4 text-center select-none">V</span>
          </div>
        </div>

        <!-- R1 / R2 Grid -->
        <div class="grid grid-cols-2 gap-4">
           <!-- R1 -->
           <div class="group/input">
             <div class="flex items-center gap-2 mb-2">
                 <label class="text-[11px] font-bold text-zinc-400 uppercase tracking-wider">Resistor 1</label>
             </div>
             
             <div class="ios-input-wrapper flex items-center justify-between bg-white border border-zinc-300 rounded-lg px-3 py-2.5">
               <label for="r1" class="text-sm font-medium text-zinc-500 shrink-0 w-6 select-none">R1</label>
               <input type="number" id="r1" value="1000" oninput="calculate('inputs')" class="text-right w-full bg-transparent border-none p-0 text-sm font-mono font-medium focus:ring-0 placeholder-zinc-300 text-zinc-900 outline-none">
               <span class="text-xs text-zinc-400 font-medium ml-2 w-4 text-center select-none">Ω</span>
             </div>
           </div>
           
           <!-- R2 -->
           <div class="group/input">
             <div class="flex items-center gap-2 mb-2">
                <label class="text-[11px] font-bold text-zinc-400 uppercase tracking-wider">Resistor 2</label>
             </div>
            
            <div class="ios-input-wrapper flex items-center justify-between bg-white border border-zinc-300 rounded-lg px-3 py-2.5">
              <label for="r2" class="text-sm font-medium text-zinc-500 shrink-0 w-6 select-none">R2</label>
              <input type="number" id="r2" value="2000" oninput="calculate('inputs')" class="text-right w-full bg-transparent border-none p-0 text-sm font-mono font-medium focus:ring-0 placeholder-zinc-300 text-zinc-900 outline-none">
              <span class="text-xs text-zinc-400 font-medium ml-2 w-4 text-center select-none">Ω</span>
            </div>
          </div>
        </div>

        <!-- RATIO SLIDER COMPONENT - DISABLED -->
        <div class="bg-zinc-50 border border-zinc-200 rounded-lg p-4 opacity-50 pointer-events-none relative group">
            <div class="flex justify-between items-end mb-2">
                <label class="text-[10px] font-bold text-zinc-500 uppercase tracking-wide">Division Ratio</label>
                <div class="text-[11px] font-mono text-zinc-700 font-semibold bg-white border border-zinc-200 px-2 py-0.5 rounded shadow-sm" id="ratio-display">66.6%</div>
            </div>
            
            <div class="relative w-full h-8 flex items-center group/slider">
                <!-- Background Ticks -->
                <div class="absolute inset-x-0 h-4 pointer-events-none flex justify-between px-2 text-[9px] text-zinc-400 select-none bottom-0 translate-y-4">
                   <span>0%</span>
                   <span>25%</span>
                   <span>50%</span>
                   <span>75%</span>
                   <span>100%</span>
                </div>
                
                <!-- Track Ticks Overlay -->
                <div class="absolute w-[calc(100%-12px)] left-[6px] flex justify-between h-1.5 pointer-events-none">
                     <div class="w-[1px] h-full bg-zinc-300"></div>
                     <div class="w-[1px] h-full bg-zinc-300"></div>
                     <div class="w-[1px] h-full bg-zinc-300"></div>
                     <div class="w-[1px] h-full bg-zinc-300"></div>
                     <div class="w-[1px] h-full bg-zinc-300"></div>
                </div>

                <!-- Range Input - DISABLED -->
                <input 
                  type="range" 
                  id="ratio-slider" 
                  min="0" 
                  max="100" 
                  step="0.1" 
                  value="66.6" 
                  class="slider-track z-10"
                  oninput="handleSliderMove()"
                  disabled
                >
            </div>
            <!-- Tooltip on hover -->
            <div class="absolute -top-10 left-1/2 -translate-x-1/2 px-3 py-2 bg-zinc-800 text-white text-[9px] font-medium rounded-lg whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50">
              Coming soon with enhanced ratio selection
            </div>
        </div>
      </form>

      <!-- Output Display (Calculated) -->
      <div>
        <label class="block text-[11px] font-bold text-zinc-400 uppercase tracking-wider mb-2">Calculated Result</label>
        <div class="relative overflow-hidden bg-[#18181b] text-white rounded-xl shadow-lg p-5 group transition-transform duration-500 hover:scale-[1.01]">
            <!-- Subtle Ambient Light (White/Grey instead of Blue) -->
            <div class="absolute -top-10 -right-10 w-32 h-32 bg-zinc-600 blur-[70px] opacity-30 rounded-full pointer-events-none" id="ambient-glow"></div>
            
            <div class="relative z-10 flex flex-col justify-center h-full">
              <p class="text-zinc-400 text-xs font-semibold mb-1 select-none">Output Voltage (Vout)</p>
              <div class="flex items-baseline gap-2">
                <span id="display-vout" class="text-5xl font-mono font-medium tracking-tighter origin-left">0.00</span>
                <span class="text-zinc-500 font-medium select-none text-lg">V</span>
              </div>
            </div>
        </div>
      </div>
      
    </div>
  </aside>

  <!-- Right Column: Visualization -->
  <main class="flex-1 relative flex flex-col bg-[#F5F5F7]">
    <!-- Canvas Area -->
    <div class="flex-1 flex items-center justify-center p-8 relative overflow-hidden">
      <!-- Background Grid -->
      <div class="absolute inset-0 pointer-events-none opacity-[0.4]" 
           style="background-image: linear-gradient(#d1d5db 1px, transparent 1px), linear-gradient(90deg, #d1d5db 1px, transparent 1px); background-size: 40px 40px; background-position: center;">
      </div>
      
      <div class="relative shadow-[0_25px_50px_-12px_rgba(0,0,0,0.1)] rounded-2xl bg-white p-2 border border-zinc-100">
        <canvas id="circuitCanvas" class="bg-white rounded-xl block"></canvas>
      </div>
    </div>
  </main>

  <script>
    const canvas = document.getElementById('circuitCanvas');
    const ctx = canvas.getContext('2d');
    
    // Application State
    let state = {
      vin: 5,
      r1: 1000,
      r2: 2000,
      vout: 3.33,
      ratio: 66.6, 
    };

    let offset = 0; // animation

    function triggerHighlight() {
      const el = document.getElementById('display-vout');
      el.classList.remove('animate-pop');
      void el.offsetWidth;
      el.classList.add('animate-pop');
    }

    // Two-Way Binding: Slider moves
    function handleSliderMove() {
      const sliderVal = parseFloat(document.getElementById('ratio-slider').value);
      state.vin = Math.abs(parseFloat(document.getElementById('vin').value) || 0);
      
      const currentR1 = Math.abs(parseFloat(document.getElementById('r1').value) || 0);
      const currentR2 = Math.abs(parseFloat(document.getElementById('r2').value) || 0);
      let totalR = currentR1 + currentR2;
      
      if(totalR <= 0) totalR = 1000;

      const percent = sliderVal / 100;
      let newR2 = totalR * percent;
      let newR1 = totalR - newR2;

      document.getElementById('r2').value = newR2.toFixed(1);
      document.getElementById('r1').value = newR1.toFixed(1);

      calculate('slider');
    }

    // Two-Way Binding: Inputs change
    function calculate(source) {
      // 1. Get Values
      state.vin = Math.abs(parseFloat(document.getElementById('vin').value) || 0);
      state.r1 = Math.abs(parseFloat(document.getElementById('r1').value) || 0);
      state.r2 = Math.abs(parseFloat(document.getElementById('r2').value) || 0);

      const totalR = state.r1 + state.r2;

      // 2. Compute Output
      if (totalR > 0) {
        state.vout = state.vin * (state.r2 / totalR);
        
        if(source !== 'slider') {
            const ratio = (state.r2 / totalR) * 100;
            state.ratio = ratio;
            document.getElementById('ratio-slider').value = ratio.toFixed(1);
        }
      } else {
        state.vout = 0;
        state.ratio = 0;
        if(source !== 'slider') document.getElementById('ratio-slider').value = 0;
      }
      
      // Update Ratio Text
      const currentSliderVal = parseFloat(document.getElementById('ratio-slider').value);
      document.getElementById('ratio-display').innerText = currentSliderVal.toFixed(1) + "%";

      // 3. Update Vout Display
      const voutStr = state.vout.toFixed(2);
      if(document.getElementById('display-vout').innerText !== voutStr) {
        document.getElementById('display-vout').innerText = voutStr;
        triggerHighlight();
      }
    }

    // ---------------- CANVAS ANIMATION ---------------- //

    function resizeCanvas() {
      const dpr = window.devicePixelRatio || 1;
      const displayW = Math.min(600, window.innerWidth - 60);
      const displayH = 500;
      if(canvas.width !== displayW * dpr) {
        canvas.width = displayW * dpr;
        canvas.height = displayH * dpr;
        canvas.style.width = `${displayW}px`;
        canvas.style.height = `${displayH}px`;
        ctx.scale(dpr, dpr);
      }
    }

    function animate() {
      offset -= 1.0; 
      if (offset < -20) offset = 0;
      draw(offset);
      requestAnimationFrame(animate);
    }

    function draw(dashOffset) {
      const w = parseFloat(canvas.style.width);
      const h = parseFloat(canvas.style.height);
      const cx = w / 2;
      const cy = h / 2;
      
      // Professional Colors
      const LINE_COLOR = '#09090b'; // zinc-950
      const TEXT_COLOR = '#18181b'; // zinc-900
      const SUB_TEXT = '#52525b';   // zinc-600
      
      ctx.clearRect(0, 0, w, h);
      ctx.lineWidth = 2.5; // Slightly thicker lines for clarity
      ctx.lineCap = 'square';
      ctx.lineJoin = 'miter';
      
      const topY = cy - 130;
      const midY = cy;
      const botY = cy + 130;
      const leftX = cx - 50;
      const rightX = cx + 80;

      // Current Flow Animation (Subtle Dashed)
      ctx.beginPath();
      ctx.strokeStyle = '#e4e4e7'; // faint grey for path
      ctx.setLineDash([4, 8]); 
      ctx.lineDashOffset = dashOffset;
      ctx.lineWidth = 3;
      ctx.moveTo(leftX, topY);
      ctx.lineTo(leftX, botY + 20);
      ctx.stroke();

      // Main Structure Lines
      ctx.setLineDash([]); 
      ctx.lineWidth = 3;
      ctx.lineDashOffset = 0;
      ctx.strokeStyle = LINE_COLOR;

      ctx.beginPath();
      ctx.moveTo(leftX, topY - 10); 
      ctx.lineTo(leftX, topY + 40); 
      // R1 Gap
      ctx.moveTo(leftX, topY + 100); 
      ctx.lineTo(leftX, midY);
      ctx.lineTo(rightX, midY); // Probe line
      ctx.moveTo(leftX, midY);
      ctx.lineTo(leftX, botY - 55);
      // R2 Gap
      ctx.moveTo(leftX, botY + 5);
      ctx.lineTo(leftX, botY + 30);
      ctx.stroke();

      // Terminal Symbols
      drawVcc(leftX, topY - 10, LINE_COLOR);
      drawGround(leftX, botY + 30, LINE_COLOR);

      // Components
      drawResistorSymbol(leftX, topY + 40, 60, LINE_COLOR); // R1 Box
      drawResistorSymbol(leftX, botY - 55, 60, LINE_COLOR); // R2 Box

      // Labels (High Contrast, Bold)
      drawComponentLabel(leftX + 25, topY + 70, "R1", state.r1);
      drawComponentLabel(leftX + 25, botY - 25, "R2", state.r2);

      // Vout Node Probe Point
      ctx.beginPath();
      ctx.arc(rightX, midY, 4, 0, Math.PI * 2);
      ctx.fillStyle = '#ffffff';
      ctx.fill();
      ctx.lineWidth = 3;
      ctx.strokeStyle = LINE_COLOR;
      ctx.stroke();

      // Vout Text
      ctx.font = "bold 15px Inter";
      ctx.fillStyle = TEXT_COLOR;
      ctx.textAlign = "left";
      ctx.textBaseline = "bottom";
      ctx.fillText("Vout", rightX + 12, midY - 6);
      
      ctx.font = "500 13px JetBrains Mono";
      ctx.fillStyle = SUB_TEXT;
      ctx.textBaseline = "top";
      ctx.fillText(state.vout.toFixed(2) + "V", rightX + 12, midY + 4);

      // Vin Label
      ctx.textAlign = "right";
      ctx.fillStyle = SUB_TEXT;
      ctx.font = "600 12px Inter";
      ctx.fillText(`Vin: ${state.vin}V`, leftX - 15, topY);
    }

    function drawVcc(x, y, color) {
      ctx.beginPath();
      ctx.moveTo(x, y);
      ctx.arc(x, y - 5, 4, 0, Math.PI * 2); // Small circle terminal
      ctx.fillStyle = '#ffffff';
      ctx.fill();
      ctx.strokeStyle = color;
      ctx.lineWidth = 2.5;
      ctx.stroke();
      
      // Plus sign above
      ctx.font = "bold 14px Inter";
      ctx.fillStyle = color;
      ctx.textAlign = "center";
      ctx.textBaseline = "bottom";
      ctx.fillText("+", x, y - 10);
    }

    function drawGround(x, y, color) {
      ctx.beginPath();
      ctx.strokeStyle = color;
      ctx.lineWidth = 2.5;
      ctx.moveTo(x - 12, y); ctx.lineTo(x + 12, y);
      ctx.moveTo(x - 7, y + 4); ctx.lineTo(x + 7, y + 4);
      ctx.moveTo(x - 2, y + 8); ctx.lineTo(x + 2, y + 8);
      ctx.stroke();
    }

    function drawResistorSymbol(x, y, height, color) {
        // Drawing a proper ZigZag Resistor symbol or a clean IEC box. 
        // Using IEC Box for "Professional/European" clean look, usually cleaner to read with text inside or next to it.
        const w = 24;
        ctx.beginPath();
        ctx.rect(x - w/2, y, w, height);
        ctx.fillStyle = '#ffffff';
        ctx.fill();
        ctx.strokeStyle = color;
        ctx.lineWidth = 2.5;
        ctx.stroke();
    }

    function drawComponentLabel(x, cy, label, val) {
      ctx.textAlign = "left";
      ctx.textBaseline = "middle";
      
      // Component Name (R1/R2)
      ctx.font = "bold 14px Inter";
      ctx.fillStyle = "#18181b"; // dark
      ctx.fillText(label, x, cy - 8);
      
      // Component Value
      ctx.font = "500 12px JetBrains Mono";
      ctx.fillStyle = "#52525b"; // slightly lighter
      ctx.fillText(formatOhms(val), x, cy + 9);
    }

    function formatOhms(n) {
      if(n >= 1000000) return (n/1000000).toFixed(1) + 'MΩ';
      if(n >= 1000) return (n/1000).toFixed(1) + 'kΩ';
      return n.toFixed(0) + 'Ω';
    }

    window.addEventListener('resize', resizeCanvas);
    
    // Init
    resizeCanvas();
    calculate('init');
    requestAnimationFrame(animate);

    // --- MOBILE KEYBOARD BACK BUTTON FIX ---
    // Prevent browser back navigation when keyboard is open
    let keyboardOpen = false;
    let historyStatePushed = false;

    // Track when inputs are focused (keyboard opens)
    document.querySelectorAll('input[type="number"]').forEach(input => {
      input.addEventListener('focus', () => {
        keyboardOpen = true;
        if (!historyStatePushed) {
          history.pushState({ keyboardOpen: true }, '');
          historyStatePushed = true;
        }
      });

      input.addEventListener('blur', () => {
        keyboardOpen = false;
        historyStatePushed = false;
      });
    });

    // Intercept back button when keyboard is open
    window.addEventListener('popstate', (e) => {
      if (keyboardOpen) {
        // Blur active input instead of navigating
        const activeElement = document.activeElement;
        if (activeElement && activeElement.tagName === 'INPUT') {
          activeElement.blur();
          // Push state back to prevent navigation
          history.pushState({ keyboardOpen: true }, '');
          e.preventDefault();
        }
      }
    });
  </script>
</body>
</html>